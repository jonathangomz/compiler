<html>
<head>
  <meta charset="UTF-8">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/3.10.0/math.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="https://wzrd.in/standalone/function-plot@1.14.0"></script>
  <title>Document</title>
  <link 
    rel="stylesheet" 
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" 
    integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" 
    crossorigin="anonymous">
    <style>
        .container{
          padding: 40px 10px;
        }
        #buttons{
          display: flex;
        }
        #buttons button{
          margin: 10px 20px;
        }
        #result{
          text-align: center;
          float: none;
          margin: 10px auto;
        }
    </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="input-grou col-sm-8">
          <input class="form-control" aria-label="With textarea" id="textfield"></input>
      </div>
      <div class="col-sm-4" id="buttons">
          <button type="button" id="check" class="btn btn-info">Check</button>
          <button type="button" id="reset" class="btn btn-secondary">Reset</button>
      </div>
      <div id="result" class="col-md-2 col-md-offset-5">
      </div>
  </div>
  <div class="row">
    <div class="col-md-2 col-md-offset-5">
        <form id="form">
          <label for="eq">Enter an equation:</label>
          <input type="text" id="eq" value="4 * sin(x) + 5 * cos(x/2)" />
          <input type="submit" value="Draw" />
        </form>
      </div>
  </div>
  <div class="row">
    <div id="plot"></div>
  </div>
</body>
<script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
<script type="module">

  import {TokenType, Token, Lexer, Parser, reservedWords} from './script/main.js';

  let tok = undefined;
  let lex = Lexer("abc+(b-c)");
  let par = Parser("abc+(b-c)");
  let listTokens = undefined; 

  $(document).ready(function(){
    $('#check').click(function(){
        tok = lex.nextToken();
        alert(tok.getType());
    });
    $('#reset').click(function(){
        lex.reboot();
    });
    $('#textfield').change(function(){
      let val = document.getElementById('textfield').value;
      if(val.length > 0){
        lex = Lexer(val);
        listTokens = lex.listOfTokens();
        let str = `<tr>
                    <th>#</th>
                    <th>Text</th>
                    <th>Type</th>
                  </tr>`;
        let i = 0;
        listTokens.forEach(function(t){
          str += "<tr><td>"+(++i)+"</td><td>"+t.getText()+"</td><td>"+t.getType()+"</td></tr>";
        });
        $('#result').find('table').text("");
        $('#result').add('table').addClass("table table-sm").append(str);
        
        par = Parser(val);
        var rs = par.tester();
        console.log(rs==undefined?"Error":"Done! Answer is: "+rs);
      }
    });
  });
</script>
<script type="text/javascript">
  function draw() {
    try {
      functionPlot({
        target: '#plot',
        data: [{
          fn: document.getElementById('eq').value,
          sampler: 'builtIn',  // this will make function-plot use the evaluator of math.js
          graphType: 'polyline'
        }]
      });
    }
    catch (err) {
      console.log(err);
      alert(err);
    }
  }

  document.getElementById('form').onsubmit = function (event) {
    event.preventDefault();
    draw();
  };

  draw();
</script>
</html>